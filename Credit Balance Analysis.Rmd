---
title: "Credit Balance Analysis using GAM and NN"
author: ""
output: html_document
editor_options: 
  chunk_output_type: console
---

The credit balance dataset contains information about 400 individuals' credit usage and other personal information. The data is stored in `Credit.csv`. It contains 8 variables, `Income`, `Limit`, `Rating`, `Cards`, `Age`, `Education`, `Student`, and `Balance`. We would like to build several statistical models to predict `Balance` (i.e. credit usage) of a person with given personal information. The data description is as follows.

+ `Income`: Income in $1,000's
+ `Limit`: Credit limit
+ `Rating`: Credit rating
+ `Cards`: Number of credit cards
+ `Age`: Age in years
+ `Education`: Education in years
+ `Student`: A factor with levels No and Yes indicating whether the individual is a student
+ `Balance`: Average credit card balance in $.

read in the data in `Credit.csv` 
```{r}

total_data <- read.csv("C:/Users/balle/Downloads/Credit.csv", header=T, stringsAsFactors=T)
```


partition the data in `total_data` into training **(80%)** and test data **(20%)** and store them as `R` objects `train_data` and `test_data` respectively, use random seed **`set.seed(7)`**
```{r}
set.seed(7)
total_obs <- nrow(total_data)
train_data_indices <- sample(1:total_obs, 0.8*total_obs)
train_data <- total_data[train_data_indices,]
test_data <- total_data[-train_data_indices,]
```

Linear Regression and GAM

Fit a linear regression model of the **original scale** `Balance` w.r.t. all 7 predictors using the **training data**, .
```{r}
lm_full <- lm(Balance~.,data = train_data)
```


Fit a GAM of the **original scale** `Balance` w.r.t. all 7 predictors using the **training data**. Use splines with **df=4** for all 6 numerical predictors, which include `Income`, `Limit`, `Rating`, `Cards`, `Age` and `Education`.
```{r}
library(gam)

gam_full <- gam(Balance~s(Income, df=4)+s(Limit, df=4)+s(Rating, df=4)+s(Cards, df=4)+s(Age, df=4)+s(Education, df=4)+Student, data = train_data)
```


Fit an NN of **standardized** `Balance` w.r.t. all 7 predictors using the **training data**. Use two hidden layers with 4 hidden units in the first layer and 2 hidden units in the second layer.


Generate the **training dataset** that are needed for the estimation of NN. In addition, use the `scale()` function to standardize the predictors by centering with mean and scaling with sd.
```{r}

x_train_nn <- model.matrix(~Income+Limit+Rating+Cards+Age+Education+Student, data = train_data)[, -1]
x_mean <- apply(x_train_nn, 2, mean)
x_sd <- apply(x_train_nn, 2, sd)
x_train_nn <- scale(x_train_nn, center=x_mean, scale=x_sd)

```


Further standardize the dependent variable `Balance` by dividing its maximum value. In addition, combine the standardized `Balance` with the standardized predictors
```{r}

y_max <- max(train_data$Balance)
x_train_nn <- cbind.data.frame(train_data$Balance/y_max, x_train_nn)
colnames(x_train_nn)[1] <- 'st_balance'
```


Generate the **test dataset** that are needed for the out-of-sample prediction evaluation of NN using the function `model.matrix`. Use the `scale()` function to standardize the predictors by centering with mean and scaling with sd.
```{r}

x_test_nn <- model.matrix(~Income+Limit+Rating+Cards+Age+Education+Student, data = test_data)[,-1]

x_test_nn <- scale(x_test_nn, center=x_mean, scale=x_sd)
```


Fit an NN that has two hidden layers with 4 hidden units in the first layer and 2 hidden units in the second layer. use random seed **`set.seed(7)`**
```{r}

library(neuralnet)
set.seed(7)
nn_full <- neuralnet(st_balance~.,data = x_train_nn, hidden = c(4,2))

```



Use `lm_full`, `gam_full` and `nn_full` to generate predictions for `Balance` on the test data.
```{r}
lm_full_pred <- predict(lm_full, newdata = test_data)
gam_full_pred <- predict(gam_full, newdata = test_data)
nn_full_pred <- predict(nn_full, newdata = x_test_nn)[,1]*y_max
```


Use the `R` package `forecast` to evaluate the prediction performance of `lm_full`, `gam_full` and `nn_full`. 
```{r}
library(forecast)

accuracy(lm_full_pred, test_data$Balance)
accuracy(gam_full_pred, test_data$Balance)
accuracy(nn_full_pred, test_data$Balance)
```

MAE for `lm_full` is 84.22484, MAE for `gam_full` is 51.80754 and MAE for `nn_full` is 29.34589
I would preper `nn_full` because it is the most accurate model. 

